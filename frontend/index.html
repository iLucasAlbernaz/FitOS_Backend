<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitOS - Seu Planejador Fitness</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>

    <div id="success-modal" class="modal" style="display: none;">
        <div class="modal-content card">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 class="modal-title success-message">Ação Concluída!</h3>
            <p id="modal-message">Mensagem de sucesso aqui.</p>
        </div>
    </div>
    <header class="app-header">
        <img src="images/logo.png" alt="Logo FitOS" class="header-logo"> 
    </header>

    <main class="container">
        <div id="auth-container" class="card auth-card">
            <div class="auth-grid">
                <div class="form-column">
                    <section id="login-section" class="form-section" style="text-align: center;">
                        <br><br><br>
                        <h2 class="form-title">Login</h2>
                        <p id="message" class="message error-message"></p> 
                        <form id="login-form">
                            <input type="email" id="login-email" class="input-field" placeholder="Email" required>
                            <input type="password" id="login-senha" class="input-field" placeholder="Senha" required>
                            <button type="submit" class="btn btn-primary">Entrar</button>
                        </form>
                        <p class="link-text">Não tem conta? <a href="#" onclick="showRegister()" class="link">Cadastre-se</a></p>
                    </section>
                </div>
                <div class="auth-image-side">
                    <img src="images/img.png" alt="Logo FitOS" class="auth-logo">
                </div>
            </div> 
            <section id="register-section" class="form-section">
                <h2 class="form-title">Cadastro</h2>
                <form id="register-form">
                    <input type="text" id="reg-nome" class="input-field" placeholder="Nome Completo" required>
                    <input type="email" id="reg-email" class="input-field" placeholder="Email" required>
                    <input type="password" id="reg-senha" class="input-field" placeholder="Senha (mín. 8 caracteres)" required>
                    <label class="input-label">Dados Iniciais:</label>
                    <input type="number" id="reg-altura" class="input-field" placeholder="Altura (m) - Ex: 1.75" required step="0.01">
                    <input type="number" id="reg-peso" class="input-field" placeholder="Peso (kg) - Ex: 82.5" required step="0.01">
                    <input type="number" id="reg-idade" class="input-field" placeholder="Idade" required>
                    <select id="reg-sexo" class="input-field" required>
                        <option value="" disabled selected>Gênero</option>
                        <option value="M">Masculino</option>
                        <option value="F">Feminino</option>
                    </select>
                    <label class="input-label">Objetivo:</label>
                    <select id="reg-objetivo" class="input-field" required>
                        <option value="" disabled selected>Objetivo Principal</option>
                        <option value="Perda de Peso">Perda de Peso</option>
                        <option value="Ganho de Massa">Ganho de Massa</option>
                        <option value="Manutenção">Manutenção</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Finalizar Cadastro</button>
                    <p class="link-text"><a href="#" onclick="showLogin()" class="link">Voltar ao Login</a></p>
                </form>
            </section>
        </div> 
        
        <div id="app-dashboard" class="container dashboard-area" style="display: none;">

            <header class="dashboard-menu">
                <nav>
                    <button class="btn btn-secondary" onclick="showDashboardSection('perfil')">Perfil</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('metas')">Metas</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('treinos')">Treinos</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('diario')">Diário</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('receitas')">Receitas</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('dieta')">Plano de Dieta</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('chat')">Assistente IA</button>
                    <button onclick="logout()" class="btn btn-danger">Sair</button>
                </nav>
            </header>

            <div class="main-content card">
                <div id="user-info" class="info-block" style="margin-bottom: 20px;"></div>

                <section id="section-perfil" class="dashboard-section">
                   <h3 class="section-title">Meu Perfil e Segurança</h3>
                   <div id="perfil-form-container"></div>
                </section>
                
                <section id="section-metas" class="dashboard-section" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Minhas Metas</h3>
                        <button id="btn-show-create-meta-form" class="btn btn-primary" style="width: auto; margin-top: 0;">+ Nova Meta</button>
                    </div>
                    <div id="metas-form-container" style="display: none;"></div>
                    <div id="metas-list-container"></div>
                </section>

                <section id="section-treinos" class="dashboard-section" style="display: none;">
                   <div class="section-header">
                       <h3 class="section-title">Minhas Rotinas de Treino</h3>
                       <button id="btn-show-create-form" class="btn btn-primary" style="width: auto; margin-top: 0;">+ Nova Rotina</button>
                   </div>
                   <div id="treinos-list-container"></div>
                   <div id="treino-form-container" style="display: none;"></div>
                </section>
                
                <section id="section-diario" class="dashboard-section" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Registro Diário</h3>
                        <button id="btn-show-create-diario-form" class="btn btn-primary" style="width: auto; margin-top: 0;">+ Novo Registro</button>
                    </div>
                    
                    <div id="diario-form-container" style="display: none;">
                        </div>
                    
                    <div id="diario-list-container">
                        </div>
                </section>
                
                <section id="section-dieta" class="dashboard-section" style="display: none;">
                   <h3 class="section-title">Meu Plano Alimentar</h3>
                   <div id="dieta-container"></div>
                </section>
                <section id="section-receitas" class="dashboard-section" style="display: none;">
                   <h3 class="section-title">Minhas Receitas</h3>
                   <div id="receitas-form-container"></div>
                   <div id="receitas-list-container"></div>
                </section>
                <section id="section-chat" class="dashboard-section" style="display: none;">
                   <h3 class="section-title">Assistente de IA</h3>
                   <div id="chat-history-container" class="info-message"></div>
                   <div class="quick-replies">
                       <button class="btn btn-secondary quick-reply-btn" data-pergunta="Me dê uma sugestão de treino para peito">Treino para Peito</button>
                       <button class="btn btn-secondary quick-reply-btn" data-pergunta="Quais alimentos são ricos em fibras?">Alimentos Ricos em Fibras</button>
                       <button class="btn btn-secondary quick-reply-btn" data-pergunta="Quantas proteínas devo consumir por dia?">Cálculo de Proteína</button>
                   </div>
                   <form id="chat-form" class="chat-form">
                       <input type="text" id="chat-pergunta" class="input-field" placeholder="Pergunte sobre dieta ou treino..." required>
                       <button type="submit" class="btn btn-primary">Perguntar</button>
                   </form>
                </section>
            </div>
        </div>
    </main>

    <script type="module" src="scripts/main.js"></script>
    
    <script>
        // Funções de Alternância do DASHBOARD (Expostas globalmente)
        function showDashboardSection(sectionId) {
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.style.display = 'none';
            });
            const targetSection = document.getElementById('section-' + sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Gatilho do Plano de Dieta
            if (sectionId === 'dieta') {
                if (window.loadDietPlan) {
                    window.loadDietPlan();
                }
            }
            // Gatilho dos Treinos
            if (sectionId === 'treinos') {
                if (window.loadTreinos) {
                    window.loadTreinos();
                }
            }
            // [GATILHO MODIFICADO]
            if (sectionId === 'diario') {
                if (window.loadDiario) {
                    window.loadDiario();
                }
            }
            // Gatilho do Chat
            if (sectionId === 'chat') {
                if (window.loadChatHistory) {
                    window.loadChatHistory();
                }
            }
            // Gatilho das Metas
            if (sectionId === 'metas') {
                if (window.loadMetas) {
                    window.loadMetas();
                }
            }
        }
        
        // Função de fechar modal (exposta globalmente)
        function closeModal() {
            const successModal = document.getElementById('success-modal');
            if (successModal) {
                 successModal.style.display = 'none';
            }
        }
    </script>
</body>
</html>